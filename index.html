<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostalgia OS - –°–∫–µ–≤–æ–º–æ—Ä—Ñ–∏–∑–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #8b6b4d;
            --secondary-color: #6d4c3d;
            --accent-color: #ffd700;
            --window-bg: linear-gradient(to bottom, #f5f5dc 0%, #e6e6c9 50%, #d2d2a8 100%);
            --taskbar-bg: linear-gradient(to bottom, #a67c52 0%, #8b5a2b 50%, #6d4c3d 100%);
            --desktop-bg: radial-gradient(circle at 20% 80%, rgba(139, 107, 77, 0.7) 0%, rgba(109, 76, 61, 0.9) 100%);
        }

        body {
            background: var(--desktop-bg);
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª */
        .desktop {
            background: var(--desktop-bg);
            height: calc(100vh - 50px);
            position: relative;
            overflow: hidden;
        }

        /* –ó–Ω–∞—á–∫–∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon:active {
            transform: scale(0.95);
        }

        .icon-image {
            width: 48px;
            height: 48px;
            margin-bottom: 8px;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
        }

        .icon-label {
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px black;
            font-weight: bold;
        }

        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é */
        .context-menu {
            position: absolute;
            background: linear-gradient(to bottom, #d4b896 0%, #b08c6e 50%, #8b5a2b 100%);
            border: 2px solid #a67c52;
            border-radius: 8px;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 10000;
            min-width: 200px;
        }

        .context-menu-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #a67c52;
            color: #4d2e19;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .context-menu-item:hover {
            background: linear-gradient(to bottom, #e6c9a8 0%, #d4b896 100%);
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        /* –í–∏–¥–∂–µ—Ç—ã */
        .widget {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .clock-widget {
            width: 150px;
            height: 150px;
            top: 50px;
            right: 50px;
        }

        .battery-widget {
            width: 120px;
            height: 80px;
            top: 220px;
            right: 50px;
        }

        .slideshow-widget {
            width: 200px;
            height: 150px;
            bottom: 100px;
            right: 50px;
            overflow: hidden;
        }

        .clock-face {
            width: 100%;
            height: 100%;
            position: relative;
            border: 3px solid #ffd700;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
        }

        .clock-hand {
            position: absolute;
            background: #ffd700;
            transform-origin: bottom center;
            left: 50%;
            bottom: 50%;
            transform: translateX(-50%);
        }

        .hour-hand {
            width: 4px;
            height: 30px;
        }

        .minute-hand {
            width: 3px;
            height: 40px;
        }

        .second-hand {
            width: 2px;
            height: 45px;
            background: #ff4444;
        }

        .battery-level {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-top: 10px;
            overflow: hidden;
        }

        .battery-fill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 15px;
            transition: width 0.5s ease;
        }

        /* –ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á */
        .taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: var(--taskbar-bg);
            border-top: 2px solid #d4b896;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ü—É—Å–∫ */
        .start-button {
            background: linear-gradient(to bottom, var(--accent-color) 0%, #ffa500 50%, #ff8c00 100%);
            border: 2px solid #ff8c00;
            border-radius: 8px;
            padding: 8px 16px;
            color: #8b4513;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(139, 69, 19, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.1s ease;
            min-width: 80px;
            text-align: center;
        }

        .start-button:hover {
            background: linear-gradient(to bottom, #ffe44d 0%, #ffb347 50%, #ff9d33 100%);
        }

        .start-button:active {
            box-shadow: 
                inset 0 2px 8px rgba(139, 69, 19, 0.5),
                0 1px 2px rgba(0, 0, 0, 0.2);
            transform: translateY(1px);
        }

        /* –û–±–ª–∞—Å—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
        .taskbar-apps {
            display: flex;
            gap: 5px;
            flex: 1;
        }

        .taskbar-app {
            background: linear-gradient(to bottom, #d4b896 0%, #b08c6e 50%, #8b5a2b 100%);
            border: 1px solid #a67c52;
            border-radius: 4px;
            padding: 6px 12px;
            color: #4d2e19;
            font-size: 12px;
            cursor: pointer;
            box-shadow: 
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –°–∏—Å—Ç–µ–º–Ω—ã–π —Ç—Ä—ç–π */
        .system-tray {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 15px;
            background: linear-gradient(to bottom, #8b5a2b 0%, #6d4c3d 100%);
            border: 1px solid #a67c52;
            border-radius: 6px;
            height: 35px;
            box-shadow: 
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                inset 0 -1px 2px rgba(0, 0, 0, 0.3);
        }

        .tray-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--accent-color);
            font-size: 12px;
        }

        .tray-icon {
            width: 16px;
            height: 16px;
            filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
        }

        /* –û–∫–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 3px solid #8b7355;
            border-radius: 8px;
            box-shadow: 
                5px 5px 15px rgba(0, 0, 0, 0.5),
                inset 0 1px 2px rgba(255, 255, 255, 0.5);
            min-width: 400px;
            min-height: 300px;
            display: none;
            resize: both;
            overflow: auto;
        }

        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100vh - 50px) !important;
            border-radius: 0;
            resize: none;
        }

        .window-header {
            background: linear-gradient(to bottom, #8b7355 0%, #6d5742 50%, #5d4730 100%);
            padding: 8px 12px;
            border-bottom: 2px solid #a67c52;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            border-radius: 5px 5px 0 0;
            user-select: none;
        }

        .window-title {
            color: var(--accent-color);
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .window-controls {
            display: flex;
            gap: 5px;
        }

        .window-control {
            width: 20px;
            height: 20px;
            border: 1px solid #a67c52;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            color: #4d2e19;
            background: linear-gradient(to bottom, #d4b896 0%, #b08c6e 100%);
            box-shadow: 
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
        }

        .window-control:hover {
            background: linear-gradient(to bottom, #e6c9a8 0%, #c9a87e 100%);
        }

        .window-control:active {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .window-content {
            padding: 20px;
            height: calc(100% - 40px);
            overflow: auto;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ */
        .settings-tabs {
            display: flex;
            background: linear-gradient(to bottom, #8b7355 0%, #6d5742 100%);
            border-bottom: 2px solid #a67c52;
        }

        .settings-tab {
            padding: 10px 20px;
            cursor: pointer;
            color: #ffd700;
            border-right: 1px solid #a67c52;
            transition: all 0.2s ease;
        }

        .settings-tab.active {
            background: linear-gradient(to bottom, #6d5742 0%, #5d4730 100%);
            border-bottom: 2px solid #ffd700;
        }

        .settings-tab:hover {
            background: linear-gradient(to bottom, #7d6752 0%, #6d5742 100%);
        }

        .settings-content {
            padding: 20px;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .update-panel {
            text-align: center;
        }

        .update-success {
            background: linear-gradient(to bottom, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .update-version {
            background: var(--window-bg);
            border: 2px solid #8b7355;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            font-size: 18px;
            color: #4d2e19;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ */
        .gallery-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .gallery-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .gallery-content {
            display: flex;
            flex: 1;
            gap: 15px;
        }

        .gallery-sidebar {
            width: 200px;
            background: linear-gradient(to bottom, #f5e6c9 0%, #e6c9a8 100%);
            border: 2px solid #deb887;
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
        }

        .gallery-viewer {
            flex: 1;
            background: #fffacd;
            border: 2px solid #deb887;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .gallery-image {
            max-width: 100%;
            max-height: 300px;
            border: 2px solid #deb887;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 2px solid #deb887;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thumbnail:hover {
            transform: scale(1.1);
            border-color: #ff8c00;
        }

        .thumbnail.active {
            border-color: #ff8c00;
            box-shadow: 0 0 8px #ff8c00;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .calculator { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; max-width: 250px; margin: 0 auto; }
        .calc-display { grid-column: 1 / -1; background: #2f1b14; color: #00ff00; padding: 10px; font-family: 'Courier New', monospace; font-size: 18px; text-align: right; border: 2px inset #666; margin-bottom: 10px; border-radius: 4px; }
        .calc-btn { background: linear-gradient(to bottom, #d4b896 0%, #8b7355 100%); border: 2px outset #a67c52; padding: 15px; font-size: 16px; font-weight: bold; color: #4d2e19; cursor: pointer; border-radius: 4px; text-align: center; }
        .calc-btn:active { border-style: inset; background: linear-gradient(to bottom, #8b7355 0%, #d4b896 100%); }

        .notepad-container { display: flex; height: 400px; background: #fffacd; border: 2px solid #deb887; border-radius: 8px; overflow: hidden; box-shadow: inset 0 0 10px rgba(139, 69, 19, 0.2); }
        .notes-sidebar { width: 200px; background: linear-gradient(to bottom, #f5e6c9 0%, #e6c9a8 100%); border-right: 2px solid #deb887; padding: 10px; overflow-y: auto; }
        .notes-list { display: flex; flex-direction: column; gap: 5px; }
        .note-item { padding: 10px; background: #fffacd; border: 1px solid #deb887; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s ease; }
        .note-item:hover { background: #ffe4b5; }
        .note-item.active { background: #ffd700; border-color: #ff8c00; }
        .note-editor { flex: 1; display: flex; flex-direction: column; padding: 10px; }
        .note-title { background: #fffacd; border: 1px solid #deb887; border-radius: 4px; padding: 8px; margin-bottom: 10px; font-size: 14px; font-weight: bold; }
        .note-content { flex: 1; background: #fffacd; border: 1px solid #deb887; border-radius: 4px; padding: 10px; resize: none; font-family: 'Courier New', monospace; font-size: 12px; }
        .note-actions { margin-top: 10px; display: flex; gap: 10px; justify-content: flex-end; }

        .browser-container { height: 400px; display: flex; flex-direction: column; }
        .browser-url-bar { display: flex; gap: 10px; margin-bottom: 10px; }
        .url-input { flex: 1; padding: 8px; border: 2px inset #a67c52; border-radius: 4px; background: #fffff0; }
        .browser-iframe { flex: 1; border: 2px inset #a67c52; border-radius: 4px; background: white; }

        .player-container { text-align: center; }
        .player-controls { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .player-btn { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(to bottom, #d4b896 0%, #8b7355 100%); border: 2px outset #a67c52; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .player-btn:active { border-style: inset; }
        .playlist { max-height: 200px; overflow-y: auto; border: 1px solid #deb887; border-radius: 4px; padding: 10px; background: #fffacd; }
        .playlist-item { padding: 8px; border-bottom: 1px solid #deb887; cursor: pointer; font-size: 12px; display: flex; justify-content: between; align-items: center; }
        .playlist-item:hover { background: #ffe4b5; }
        .playlist-item.playing { background: #ffd700; font-weight: bold; }

        .explorer-container { height: 400px; display: flex; }
        .explorer-sidebar { width: 150px; background: linear-gradient(to bottom, #f5e6c9 0%, #e6c9a8 100%); border-right: 2px solid #deb887; padding: 10px; }
        .explorer-folders { display: flex; flex-direction: column; gap: 5px; }
        .folder-item { padding: 8px; background: #fffacd; border: 1px solid #deb887; border-radius: 4px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px; }
        .folder-item:hover { background: #ffe4b5; }
        .explorer-content { flex: 1; padding: 10px; background: #fffacd; overflow-y: auto; }
        .file-item { padding: 8px; margin: 5px 0; background: #fffacd; border: 1px solid #deb887; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .file-item:hover { background: #ffe4b5; }

        .installer-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-input { padding: 8px; border: 2px inset #a67c52; border-radius: 4px; background: #fffff0; }
        .icon-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 10px 0; }
        .icon-option { padding: 10px; border: 2px solid #deb887; border-radius: 4px; cursor: pointer; text-align: center; background: #fffacd; }
        .icon-option.selected { border-color: #ff8c00; background: #ffe4b5; }

        .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .theme-option { padding: 20px; border: 2px solid #deb887; border-radius: 8px; cursor: pointer; text-align: center; background: #fffacd; }
        .theme-option.selected { border-color: #ff8c00; background: #ffe4b5; }
        .custom-theme-upload { margin-top: 20px; padding: 15px; border: 2px dashed #deb887; border-radius: 8px; text-align: center; background: #fffacd; }

        .app-window { position: absolute; background: var(--window-bg); border: 3px solid #8b7355; border-radius: 8px; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.5); min-width: 600px; min-height: 400px; display: none; resize: both; overflow: auto; }
        .app-window.maximized { top: 0 !important; left: 0 !important; width: 100% !important; height: calc(100vh - 50px) !important; border-radius: 0; resize: none; }
        .app-iframe { width: 100%; height: calc(100% - 40px); border: none; border-radius: 0 0 5px 5px; }

        .start-menu { position: absolute; bottom: 50px; left: 10px; width: 300px; background: linear-gradient(to bottom, #d4b896 0%, #b08c6e 50%, #8b5a2b 100%); border: 3px solid #a67c52; border-radius: 8px; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5); display: none; z-index: 1000; }
        .start-menu-header { background: linear-gradient(to bottom, #8b5a2b 0%, #6d4c3d 100%); padding: 15px; color: var(--accent-color); font-weight: bold; font-size: 18px; text-align: center; border-bottom: 2px solid #a67c52; }
        .start-menu-items { padding: 10px; }
        .start-menu-item { padding: 10px; margin: 5px 0; background: linear-gradient(to bottom, #e6c9a8 0%, #d4b896 100%); border: 1px solid #a67c52; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.2s ease; }
        .start-menu-item:hover { background: linear-gradient(to bottom, #f5e6c9 0%, #e6c9a8 100%); transform: translateX(5px); }

        .skeuomorphic-btn { background: linear-gradient(to bottom, #d4b896 0%, #8b7355 100%); border: 2px outset #a67c52; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; color: #4d2e19; text-align: center; }
        .skeuomorphic-btn:active { border-style: inset; background: linear-gradient(to bottom, #8b7355 0%, #d4b896 100%); }
        .danger-btn { background: linear-gradient(to bottom, #ff6b6b 0%, #cc5555 100%); border: 2px outset #cc3333; color: white; }
        .danger-btn:active { background: linear-gradient(to bottom, #cc5555 0%, #ff6b6b 100%); }

        .toggle-switch { position: relative; width: 50px; height: 24px; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: #2196F3; }
        input:checked + .toggle-slider:before { transform: translateX(26px); }

        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #deb887; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .window, .start-menu, .app-window { animation: fadeIn 0.2s ease-out; }

        .hidden-file-input { display: none; }
    </style>
</head>
<body>
    <div class="desktop" id="desktop" oncontextmenu="showContextMenu(event); return false;">
        <!-- –ó–Ω–∞—á–∫–∏ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞ -->
        <div class="desktop-icons" id="desktopIcons">
            <!-- –ó–Ω–∞—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>

        <!-- –í–∏–¥–∂–µ—Ç—ã -->
        <div class="widget clock-widget" id="clockWidget" style="display: none;">
            <div class="clock-face">
                <div class="clock-hand hour-hand" id="hourHand"></div>
                <div class="clock-hand minute-hand" id="minuteHand"></div>
                <div class="clock-hand second-hand" id="secondHand"></div>
            </div>
        </div>

        <div class="widget battery-widget" id="batteryWidget" style="display: none;">
            <div>üîã –ó–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–∏</div>
            <div class="battery-level">
                <div class="battery-fill" id="batteryFill" style="width: 85%;"></div>
            </div>
        </div>

        <div class="widget slideshow-widget" id="slideshowWidget" style="display: none;">
            <div>üñºÔ∏è –°–ª–∞–π–¥-—à–æ—É</div>
            <img id="slideshowImage" src="" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px; margin-top: 5px;">
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="openApp('settings'); hideContextMenu()">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
        <div class="context-menu-item" onclick="toggleWidgets(); hideContextMenu()">üìä –í–∏–¥–∂–µ—Ç—ã</div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á -->
    <div class="taskbar">
        <div class="start-button" onclick="toggleStartMenu()">
            –ü–£–°–ö
        </div>
        <div class="taskbar-apps" id="taskbarApps">
            <!-- –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
        <div class="system-tray">
            <div class="tray-item">
                <span class="tray-icon">üîä</span>
                <span>85%</span>
            </div>
            <div class="tray-item">
                <span class="tray-icon">üîã</span>
                <span>100%</span>
            </div>
            <div class="tray-item" id="clock">
                14:25
            </div>
        </div>
    </div>

    <!-- –ú–µ–Ω—é –ü—É—Å–∫ -->
    <div class="start-menu" id="startMenu">
        <div class="start-menu-header">
            Nostalgia OS
        </div>
        <div class="start-menu-items">
            <div class="start-menu-item" onclick="openApp('notepad')">
                <span>üìù</span> –ë–ª–æ–∫–Ω–æ—Ç
            </div>
            <div class="start-menu-item" onclick="openApp('calculator')">
                <span>üßÆ</span> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
            </div>
            <div class="start-menu-item" onclick="openApp('browser')">
                <span>üåê</span> –í–µ–±-–±—Ä–∞—É–∑–µ—Ä
            </div>
            <div class="start-menu-item" onclick="openApp('player')">
                <span>üéµ</span> –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å
            </div>
            <div class="start-menu-item" onclick="openApp('gallery')">
                <span>üñºÔ∏è</span> –ì–∞–ª–µ—Ä–µ—è
            </div>
            <div class="start-menu-item" onclick="openApp('explorer')">
                <span>üìÅ</span> –ü—Ä–æ–≤–æ–¥–Ω–∏–∫
            </div>
            <div class="start-menu-item" onclick="openApp('settings')">
                <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </div>
            <div class="start-menu-item" onclick="openApp('themes')">
                <span>üé®</span> –¢–µ–º—ã
            </div>
            <div class="start-menu-item" onclick="openApp('installer')">
                <span>üì¶</span> –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫
            </div>
            <div class="start-menu-item" onclick="shutdown()">
                <span>‚≠ï</span> –í—ã–∫–ª—é—á–µ–Ω–∏–µ
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" id="musicFileInput" class="hidden-file-input" accept="audio/*" multiple>
    <input type="file" id="imageFileInput" class="hidden-file-input" accept="image/*" multiple>
    <input type="file" id="wallpaperFileInput" class="hidden-file-input" accept="image/*">

    <!-- –û–∫–Ω–æ –±–ª–æ–∫–Ω–æ—Ç–∞ -->
    <div class="window" id="notepadWindow" style="top: 100px; left: 200px; width: 700px; height: 500px;">
        <div class="window-header">
            <div class="window-title">üìù –ë–ª–æ–∫–Ω–æ—Ç Nostalgia</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('notepad')">_</div>
                <div class="window-control" onclick="toggleMaximize('notepad')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('notepad')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="notepad-container">
                <div class="notes-sidebar">
                    <div class="skeuomorphic-btn" onclick="createNewNote()" style="margin-bottom: 10px;">+ –ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</div>
                    <div class="notes-list" id="notesList"></div>
                </div>
                <div class="note-editor">
                    <input type="text" class="note-title" id="noteTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏">
                    <textarea class="note-content" id="noteContent" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å..."></textarea>
                    <div class="note-actions">
                        <div class="skeuomorphic-btn" onclick="saveNote()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</div>
                        <div class="skeuomorphic-btn" onclick="deleteNote()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
    <div class="window" id="calculatorWindow" style="top: 150px; left: 300px;">
        <div class="window-header">
            <div class="window-title">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('calculator')">_</div>
                <div class="window-control" onclick="toggleMaximize('calculator')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('calculator')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="calculator">
                <div class="calc-display" id="calcDisplay">0</div>
                <div class="calc-btn" onclick="clearCalc()">C</div>
                <div class="calc-btn" onclick="appendToCalc('/')">/</div>
                <div class="calc-btn" onclick="appendToCalc('*')">√ó</div>
                <div class="calc-btn" onclick="appendToCalc('-')">-</div>
                <div class="calc-btn" onclick="appendToCalc('7')">7</div>
                <div class="calc-btn" onclick="appendToCalc('8')">8</div>
                <div class="calc-btn" onclick="appendToCalc('9')">9</div>
                <div class="calc-btn" onclick="appendToCalc('+')" style="grid-row: span 2">+</div>
                <div class="calc-btn" onclick="appendToCalc('4')">4</div>
                <div class="calc-btn" onclick="appendToCalc('5')">5</div>
                <div class="calc-btn" onclick="appendToCalc('6')">6</div>
                <div class="calc-btn" onclick="appendToCalc('1')">1</div>
                <div class="calc-btn" onclick="appendToCalc('2')">2</div>
                <div class="calc-btn" onclick="appendToCalc('3')">3</div>
                <div class="calc-btn" onclick="calculate()" style="grid-row: span 2">=</div>
                <div class="calc-btn" onclick="appendToCalc('0')" style="grid-column: span 2">0</div>
                <div class="calc-btn" onclick="appendToCalc('.')">.</div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <div class="window" id="browserWindow" style="top: 200px; left: 400px; width: 800px; height: 600px;">
        <div class="window-header">
            <div class="window-title">üåê Nostalgia Browser</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('browser')">_</div>
                <div class="window-control" onclick="toggleMaximize('browser')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('browser')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="browser-container">
                <div class="browser-url-bar">
                    <input type="text" class="url-input" id="urlInput" placeholder="–í–≤–µ–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://google.com)" value="https://google.com">
                    <div class="skeuomorphic-btn" onclick="browseToUrl()">–ü–µ—Ä–µ–π—Ç–∏</div>
                </div>
                <iframe class="browser-iframe" id="browserIframe" src="https://google.com"></iframe>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è -->
    <div class="window" id="playerWindow" style="top: 250px; left: 500px; width: 400px; height: 500px;">
        <div class="window-header">
            <div class="window-title">üéµ Nostalgia Player</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('player')">_</div>
                <div class="window-control" onclick="toggleMaximize('player')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('player')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="player-container">
                <h3>–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç:</h3>
                <div id="nowPlaying">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                
                <audio id="audioPlayer" controls style="width: 100%; margin: 10px 0;"></audio>

                <div class="player-controls">
                    <div class="player-btn" onclick="playPrevious()">‚èÆÔ∏è</div>
                    <div class="player-btn" onclick="togglePlay()" id="playBtn">‚ñ∂Ô∏è</div>
                    <div class="player-btn" onclick="playNext()">‚è≠Ô∏è</div>
                </div>

                <h4>–ü–ª–µ–π–ª–∏—Å—Ç:</h4>
                <div class="playlist" id="playlist"></div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –≥–∞–ª–µ—Ä–µ–∏ -->
    <div class="window" id="galleryWindow" style="top: 100px; left: 200px; width: 800px; height: 600px;">
        <div class="window-header">
            <div class="window-title">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('gallery')">_</div>
                <div class="window-control" onclick="toggleMaximize('gallery')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('gallery')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="gallery-container">
                <div class="gallery-toolbar">
                    <div class="skeuomorphic-btn" onclick="loadImageFiles()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    <div class="skeuomorphic-btn" onclick="startSlideshow()">‚ñ∂Ô∏è –°–ª–∞–π–¥-—à–æ—É</div>
                    <div class="skeuomorphic-btn" onclick="stopSlideshow()">‚èπÔ∏è –°—Ç–æ–ø</div>
                </div>
                <div class="gallery-content">
                    <div class="gallery-sidebar">
                        <h4>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</h4>
                        <div class="thumbnail-grid" id="thumbnailGrid"></div>
                    </div>
                    <div class="gallery-viewer">
                        <img id="galleryImage" class="gallery-image" src="" style="display: none;">
                        <div id="galleryPlaceholder" style="text-align: center; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 20px;">üñºÔ∏è</div>
                            <div>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞ -->
    <div class="window" id="explorerWindow" style="top: 100px; left: 200px; width: 600px; height: 500px;">
        <div class="window-header">
            <div class="window-title">üìÅ –ü—Ä–æ–≤–æ–¥–Ω–∏–∫</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('explorer')">_</div>
                <div class="window-control" onclick="toggleMaximize('explorer')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('explorer')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="explorer-container">
                <div class="explorer-sidebar">
                    <div class="explorer-folders">
                        <div class="folder-item" onclick="openFolder('system')">
                            <span>üíª</span> –°–∏—Å—Ç–µ–º–∞
                        </div>
                    </div>
                </div>
                <div class="explorer-content" id="explorerContent">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="window" id="settingsWindow" style="top: 150px; left: 300px; width: 600px; height: 500px;">
        <div class="window-header">
            <div class="window-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('settings')">_</div>
                <div class="window-control" onclick="toggleMaximize('settings')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('settings')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="settings-tabs">
                <div class="settings-tab active" onclick="switchSettingsTab('system')">–°–∏—Å—Ç–µ–º–∞</div>
                <div class="settings-tab" onclick="switchSettingsTab('update')">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û</div>
            </div>
            <div class="settings-content">
                <div class="settings-panel active" id="systemPanel">
                    <div class="settings-container">
                        <div class="setting-item">
                            <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ–∫—É–Ω–¥—ã –≤ —á–∞—Å–∞—Ö</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showSeconds" onchange="toggleSeconds()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>–°–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã</span>
                            <div class="skeuomorphic-btn danger-btn" onclick="resetSystem()">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-panel" id="updatePanel">
                    <div class="update-panel">
                        <div class="update-success">
                            ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ!
                        </div>
                        <div class="update-version">
                            Nostalgia OS
                        </div>
                        <div style="font-size: 16px; color: #4d2e19; margin-top: 20px;">
                            –í–µ—Ä—Å–∏—è 1.1
                        </div>
                        <div style="margin-top: 30px; font-size: 14px; color: #666;">
                            –í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="window" id="themesWindow" style="top: 200px; left: 400px; width: 500px; height: 500px;">
        <div class="window-header">
            <div class="window-title">üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('themes')">_</div>
                <div class="window-control" onclick="toggleMaximize('themes')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('themes')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="theme-grid">
                <div class="theme-option" onclick="changeTheme('classic')">üèõÔ∏è –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è</div>
                <div class="theme-option" onclick="changeTheme('dark')">üåô –¢—ë–º–Ω–∞—è</div>
                <div class="theme-option" onclick="changeTheme('blue')">üîµ –°–∏–Ω—è—è</div>
                <div class="theme-option" onclick="changeTheme('green')">üü¢ –ó–µ–ª—ë–Ω–∞—è</div>
            </div>
            <div class="custom-theme-upload">
                <h4>üí´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±–æ–∏</h4>
                <div class="skeuomorphic-btn" onclick="document.getElementById('wallpaperFileInput').click()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–æ–∏</div>
                <div style="margin-top: 10px; font-size: 12px; color: #666;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF</div>
            </div>
        </div>
    </div>

    <div class="window" id="installerWindow" style="top: 250px; left: 500px; width: 600px; height: 500px;">
        <div class="window-header">
            <div class="window-title">üì¶ –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º</div>
            <div class="window-controls">
                <div class="window-control" onclick="minimizeWindow('installer')">_</div>
                <div class="window-control" onclick="toggleMaximize('installer')">‚ñ°</div>
                <div class="window-control" onclick="closeWindow('installer')">√ó</div>
            </div>
        </div>
        <div class="window-content">
            <div class="installer-form">
                <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:</label><input type="text" class="form-input" id="appName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"></div>
                <div class="form-group"><label>URL –ø—Ä–æ–≥—Ä–∞–º–º—ã:</label><input type="text" class="form-input" id="appUrl" placeholder="https://example.com"></div>
                <div class="form-group"><label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É:</label><div class="icon-grid" id="iconGrid"></div></div>
                <div class="skeuomorphic-btn" onclick="installApp()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</div>
            </div>
            <div id="installedApps"></div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ–∫–æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π -->
    <div id="appWindowsContainer"></div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let openApps = {};
        let zIndex = 1000;
        let currentNoteId = null;
        let musicFiles = JSON.parse(localStorage.getItem('musicFiles')) || [];
        let imageFiles = JSON.parse(localStorage.getItem('imageFiles')) || [];
        let currentTrack = 0;
        let currentImage = 0;
        let isPlaying = false;
        let isSlideshowPlaying = false;
        let slideshowInterval = null;
        let audioPlayer = null;
        let installedApps = [];
        let widgetsEnabled = JSON.parse(localStorage.getItem('widgetsEnabled')) || false;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadFromLocalStorage() {
            const savedNotes = localStorage.getItem('notes');
            notes = savedNotes ? JSON.parse(savedNotes) : [];

            const savedSettings = localStorage.getItem('systemSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('showSeconds').checked = settings.showSeconds || false;
                document.getElementById('autoRefresh').checked = settings.autoRefresh || false;
            }

            const savedTheme = localStorage.getItem('currentTheme');
            if (savedTheme) changeTheme(savedTheme, false);

            const savedApps = localStorage.getItem('installedApps');
            installedApps = savedApps ? JSON.parse(savedApps) : [];
            renderDesktopIcons();

            const savedWallpaper = localStorage.getItem('customWallpaper');
            if (savedWallpaper) {
                document.body.style.backgroundImage = `url(${savedWallpaper})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
            }

            if (widgetsEnabled) {
                showWidgets();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveToLocalStorage() {
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('musicFiles', JSON.stringify(musicFiles));
            localStorage.setItem('imageFiles', JSON.stringify(imageFiles));
            localStorage.setItem('installedApps', JSON.stringify(installedApps));
            localStorage.setItem('widgetsEnabled', JSON.stringify(widgetsEnabled));
            
            const settings = {
                showSeconds: document.getElementById('showSeconds').checked,
                autoRefresh: document.getElementById('autoRefresh').checked
            };
            localStorage.setItem('systemSettings', JSON.stringify(settings));
        }

        // –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª –±–µ–∑ —Å—Ç–æ–ª–±–∏–∫–æ–≤
        function renderDesktopIcons() {
            const desktopIcons = document.getElementById('desktopIcons');
            desktopIcons.innerHTML = '';

            const systemIcons = [
                { name: '–ë–ª–æ–∫–Ω–æ—Ç', icon: 'üìù', app: 'notepad' },
                { name: '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä', icon: 'üßÆ', app: 'calculator' },
                { name: '–ë—Ä–∞—É–∑–µ—Ä', icon: 'üåê', app: 'browser' },
                { name: '–ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å', icon: 'üéµ', app: 'player' },
                { name: '–ì–∞–ª–µ—Ä–µ—è', icon: 'üñºÔ∏è', app: 'gallery' },
                { name: '–ü—Ä–æ–≤–æ–¥–Ω–∏–∫', icon: 'üìÅ', app: 'explorer' },
                { name: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', icon: '‚öôÔ∏è', app: 'settings' },
                { name: '–¢–µ–º—ã', icon: 'üé®', app: 'themes' },
                { name: '–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫', icon: 'üì¶', app: 'installer' }
            ];

            systemIcons.forEach(item => {
                const icon = createDesktopIcon(item.name, item.icon, () => openApp(item.app));
                desktopIcons.appendChild(icon);
            });

            installedApps.forEach(app => {
                const icon = createDesktopIcon(app.name, app.icon, () => openInstalledApp(app.id));
                desktopIcons.appendChild(icon);
            });
        }

        function createDesktopIcon(name, icon, onClick) {
            const div = document.createElement('div');
            div.className = 'desktop-icon';
            div.onclick = onClick;
            div.innerHTML = `
                <div class="icon-image">${icon}</div>
                <div class="icon-label">${name}</div>
            `;
            return div;
        }

        // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        function showContextMenu(event) {
            event.preventDefault();
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = event.clientX + 'px';
            menu.style.top = event.clientY + 'px';
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        // –í–∏–¥–∂–µ—Ç—ã
        function toggleWidgets() {
            widgetsEnabled = !widgetsEnabled;
            if (widgetsEnabled) {
                showWidgets();
            } else {
                hideWidgets();
            }
            saveToLocalStorage();
        }

        function showWidgets() {
            document.getElementById('clockWidget').style.display = 'block';
            document.getElementById('batteryWidget').style.display = 'block';
            document.getElementById('slideshowWidget').style.display = 'block';
            updateClockWidget();
            updateSlideshow();
        }

        function hideWidgets() {
            document.getElementById('clockWidget').style.display = 'none';
            document.getElementById('batteryWidget').style.display = 'none';
            document.getElementById('slideshowWidget').style.display = 'none';
        }

        function updateClockWidget() {
            const now = new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            document.getElementById('hourHand').style.transform = `translateX(-50%) rotate(${hours * 30 + minutes * 0.5}deg)`;
            document.getElementById('minuteHand').style.transform = `translateX(-50%) rotate(${minutes * 6}deg)`;
            document.getElementById('secondHand').style.transform = `translateX(-50%) rotate(${seconds * 6}deg)`;
        }

        function updateSlideshow() {
            if (imageFiles.length > 0) {
                const img = document.getElementById('slideshowImage');
                img.src = imageFiles[currentImage].url;
                currentImage = (currentImage + 1) % imageFiles.length;
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏
        function toggleMaximize(appName) {
            const window = document.getElementById(appName + 'Window');
            if (window) {
                window.classList.toggle('maximized');
                const maxBtn = window.querySelector('.window-controls .window-control:nth-child(2)');
                maxBtn.textContent = window.classList.contains('maximized') ? '‚ùê' : '‚ñ°';
            }
        }

        // –ì–∞–ª–µ—Ä–µ—è
        function loadImageFiles() {
            document.getElementById('imageFileInput').click();
        }

        function handleImageFiles(event) {
            const files = event.target.files;
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const url = URL.createObjectURL(file);
                    imageFiles.push({
                        name: file.name,
                        url: url,
                        file: file
                    });
                }
            }
            saveToLocalStorage();
            renderThumbnails();
        }

        function renderThumbnails() {
            const grid = document.getElementById('thumbnailGrid');
            grid.innerHTML = '';
            
            imageFiles.forEach((image, index) => {
                const thumbnail = document.createElement('img');
                thumbnail.className = 'thumbnail';
                thumbnail.src = image.url;
                thumbnail.onclick = () => showImage(index);
                grid.appendChild(thumbnail);
            });
        }

        function showImage(index) {
            const image = imageFiles[index];
            const img = document.getElementById('galleryImage');
            const placeholder = document.getElementById('galleryPlaceholder');
            
            img.src = image.url;
            img.style.display = 'block';
            placeholder.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –º–∏–Ω–∏–∞—Ç—é—Ä—É
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
            
            currentImage = index;
        }

        function startSlideshow() {
            if (imageFiles.length === 0) return;
            stopSlideshow();
            isSlideshowPlaying = true;
            let index = currentImage;
            
            slideshowInterval = setInterval(() => {
                showImage(index);
                index = (index + 1) % imageFiles.length;
            }, 3000);
        }

        function stopSlideshow() {
            isSlideshowPlaying = false;
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
            }
        }

        // –ü—Ä–æ–≤–æ–¥–Ω–∏–∫
        function openFolder(folderName) {
            const content = document.getElementById('explorerContent');
            
            if (folderName === 'system') {
                content.innerHTML = `
                    <div class="folder-item" onclick="openFolder('music')"><span>üéµ</span> –ú—É–∑—ã–∫–∞ üé∂</div>
                    <div class="folder-item" onclick="openFolder('gallery')"><span>üñºÔ∏è</span> –ì–∞–ª–µ—Ä–µ—è üñºÔ∏è</div>
                    <div class="folder-item" onclick="openSystemFiles()"><span>üíø</span> –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã üíø</div>
                `;
            } else if (folderName === 'music') {
                content.innerHTML = `
                    <h3>–ü–∞–ø–∫–∞ "–ú—É–∑—ã–∫–∞ üé∂"</h3>
                    <div class="skeuomorphic-btn" onclick="loadMusicFiles()">üéµ –ó–∞–≥—Ä—É–∑–∏—Ç—å –º—É–∑—ã–∫—É</div>
                    ${musicFiles.length > 0 ? `
                        <div style="margin-top: 15px;"><h4>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                        ${musicFiles.map((file, index) => `
                            <div class="file-item" onclick="playTrack(${index})"><span>üéµ</span> ${file.name}</div>
                        `).join('')}</div>
                    ` : ''}
                `;
            } else if (folderName === 'gallery') {
                content.innerHTML = `
                    <h3>–ü–∞–ø–∫–∞ "–ì–∞–ª–µ—Ä–µ—è üñºÔ∏è"</h3>
                    <div class="skeuomorphic-btn" onclick="loadImageFiles()">üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    ${imageFiles.length > 0 ? `
                        <div style="margin-top: 15px;"><h4>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                        ${imageFiles.map((file, index) => `
                            <div class="file-item" onclick="showImageInGallery(${index})"><span>üñºÔ∏è</span> ${file.name}</div>
                        `).join('')}</div>
                    ` : ''}
                `;
            }
        }

        function showImageInGallery(index) {
            openApp('gallery');
            setTimeout(() => showImage(index), 100);
        }

        function openSystemFiles() {
            const content = document.getElementById('explorerContent');
            content.innerHTML = `
                <div style="text-align: center; padding: 50px; color: #8b0000;">
                    <h2>‚ö†Ô∏è –û–π!</h2>
                    <p>–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ–ª—å–∑—è :(</p>
                    <p style="font-size: 12px; margin-top: 20px;">–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã.<br>–ò—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã.</p>
                </div>
            `;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏
        function switchSettingsTab(tabName) {
            document.querySelectorAll('.settings-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.settings-panel').forEach(panel => panel.classList.remove('active'));
            
            document.querySelector(`.settings-tab:nth-child(${tabName === 'system' ? 1 : 2})`).classList.add('active');
            document.getElementById(tabName + 'Panel').classList.add('active');
        }

        // –ë–ª–æ–∫–Ω–æ—Ç
        let notes = [];
        function initNotepad() {
            renderNotesList();
            if (notes.length > 0) {
                loadNote(notes[0].id);
            }
        }

        function renderNotesList() {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = '';
            
            notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = `note-item ${note.id === currentNoteId ? 'active' : ''}`;
                noteElement.textContent = note.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                noteElement.onclick = () => loadNote(note.id);
                notesList.appendChild(noteElement);
            });
        }

        function loadNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (note) {
                currentNoteId = noteId;
                document.getElementById('noteTitle').value = note.title;
                document.getElementById('noteContent').value = note.content;
                renderNotesList();
            }
        }

        function createNewNote() {
            const newNote = {
                id: Date.now().toString(),
                title: '–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞',
                content: ''
            };
            notes.push(newNote);
            saveToLocalStorage();
            loadNote(newNote.id);
            renderNotesList();
        }

        function saveNote() {
            if (!currentNoteId) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].title = document.getElementById('noteTitle').value;
                notes[noteIndex].content = document.getElementById('noteContent').value;
                saveToLocalStorage();
                renderNotesList();
            }
        }

        function deleteNote() {
            if (!currentNoteId) return;
            
            notes = notes.filter(n => n.id !== currentNoteId);
            saveToLocalStorage();
            
            if (notes.length > 0) {
                loadNote(notes[0].id);
            } else {
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
                currentNoteId = null;
            }
            renderNotesList();
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
        let calcValue = '0';
        let shouldResetDisplay = false;

        function updateCalcDisplay() {
            document.getElementById('calcDisplay').textContent = calcValue;
        }

        function appendToCalc(value) {
            if (shouldResetDisplay) {
                calcValue = '';
                shouldResetDisplay = false;
            }

            if (calcValue === '0' && value !== '.') {
                calcValue = value;
            } else {
                calcValue += value;
            }
            updateCalcDisplay();
        }

        function clearCalc() {
            calcValue = '0';
            updateCalcDisplay();
        }

        function calculate() {
            try {
                calcValue = eval(calcValue.replace('√ó', '*')).toString();
            } catch (e) {
                calcValue = 'Error';
            }
            shouldResetDisplay = true;
            updateCalcDisplay();
        }

        // –ë—Ä–∞—É–∑–µ—Ä
        function browseToUrl() {
            const url = document.getElementById('urlInput').value;
            const iframe = document.getElementById('browserIframe');
            
            if (!url.startsWith('http')) {
                iframe.src = 'https://' + url;
            } else {
                iframe.src = url;
            }
        }

        // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å
        function initPlayer() {
            audioPlayer = document.getElementById('audioPlayer');
            renderPlaylist();
        }

        function loadMusicFiles() {
            document.getElementById('musicFileInput').click();
        }

        function handleMusicFiles(event) {
            const files = event.target.files;
            for (let file of files) {
                if (file.type.startsWith('audio/')) {
                    const url = URL.createObjectURL(file);
                    musicFiles.push({
                        name: file.name,
                        url: url,
                        file: file
                    });
                }
            }
            saveToLocalStorage();
            renderPlaylist();
        }

        function renderPlaylist() {
            const playlist = document.getElementById('playlist');
            playlist.innerHTML = '';
            
            if (musicFiles.length === 0) {
                playlist.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏</div>';
                return;
            }
            
            musicFiles.forEach((track, index) => {
                const trackElement = document.createElement('div');
                trackElement.className = `playlist-item ${index === currentTrack ? 'playing' : ''}`;
                trackElement.innerHTML = `
                    <span>üéµ</span>
                    <span style="flex: 1;">${track.name}</span>
                    <span style="font-size: 10px; color: #666;" onclick="event.stopPropagation(); removeTrack(${index})">üóëÔ∏è</span>
                `;
                trackElement.onclick = () => playTrack(index);
                playlist.appendChild(trackElement);
            });
        }

        function playTrack(index) {
            if (musicFiles.length === 0) return;
            
            currentTrack = index;
            const track = musicFiles[index];
            document.getElementById('nowPlaying').textContent = track.name;
            audioPlayer.src = track.url;
            audioPlayer.play();
            isPlaying = true;
            document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
            renderPlaylist();
        }

        function togglePlay() {
            if (!audioPlayer.src) return;
            
            if (isPlaying) {
                audioPlayer.pause();
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
            } else {
                audioPlayer.play();
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
            }
            isPlaying = !isPlaying;
        }

        function playNext() {
            if (musicFiles.length === 0) return;
            currentTrack = (currentTrack + 1) % musicFiles.length;
            playTrack(currentTrack);
        }

        function playPrevious() {
            if (musicFiles.length === 0) return;
            currentTrack = (currentTrack - 1 + musicFiles.length) % musicFiles.length;
            playTrack(currentTrack);
        }

        function removeTrack(index) {
            if (currentTrack === index) {
                audioPlayer.pause();
                audioPlayer.src = '';
                document.getElementById('nowPlaying').textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            }
            musicFiles.splice(index, 1);
            saveToLocalStorage();
            renderPlaylist();
        }

        // –¢–µ–º—ã
        function changeTheme(themeName, save = true) {
            const root = document.documentElement;
            
            switch(themeName) {
                case 'dark':
                    root.style.setProperty('--primary-color', '#2d2d2d');
                    root.style.setProperty('--secondary-color', '#1a1a1a');
                    root.style.setProperty('--accent-color', '#ff6b6b');
                    root.style.setProperty('--window-bg', 'linear-gradient(to bottom, #3d3d3d 0%, #2d2d2d 50%, #1d1d1d 100%)');
                    root.style.setProperty('--taskbar-bg', 'linear-gradient(to bottom, #4d4d4d 0%, #3d3d3d 50%, #2d2d2d 100%)');
                    root.style.setProperty('--desktop-bg', 'radial-gradient(circle at 20% 80%, rgba(45, 45, 45, 0.7) 0%, rgba(26, 26, 26, 0.9) 100%)');
                    break;
                case 'blue':
                    root.style.setProperty('--primary-color', '#4a6b8b');
                    root.style.setProperty('--secondary-color', '#2d4a6b');
                    root.style.setProperty('--accent-color', '#4dabf7');
                    root.style.setProperty('--window-bg', 'linear-gradient(to bottom, #5b8bb4 0%, #4a6b8b 50%, #3d5a7b 100%)');
                    root.style.setProperty('--taskbar-bg', 'linear-gradient(to bottom, #6b8bab 0%, #5b7b9b 50%, #4a6b8b 100%)');
                    root.style.setProperty('--desktop-bg', 'radial-gradient(circle at 20% 80%, rgba(74, 107, 139, 0.7) 0%, rgba(45, 74, 107, 0.9) 100%)');
                    break;
                case 'green':
                    root.style.setProperty('--primary-color', '#4b6b4d');
                    root.style.setProperty('--secondary-color', '#2d4a2d');
                    root.style.setProperty('--accent-color', '#51cf66');
                    root.style.setProperty('--window-bg', 'linear-gradient(to bottom, #5b8b5d 0%, #4b6b4d 50%, #3d5a3d 100%)');
                    root.style.setProperty('--taskbar-bg', 'linear-gradient(to bottom, #6b9b6d 0%, #5b8b5d 50%, #4b6b4d 100%)');
                    root.style.setProperty('--desktop-bg', 'radial-gradient(circle at 20% 80%, rgba(75, 107, 77, 0.7) 0%, rgba(45, 74, 45, 0.9) 100%)');
                    break;
                default: // classic
                    root.style.setProperty('--primary-color', '#8b6b4d');
                    root.style.setProperty('--secondary-color', '#6d4c3d');
                    root.style.setProperty('--accent-color', '#ffd700');
                    root.style.setProperty('--window-bg', 'linear-gradient(to bottom, #f5f5dc 0%, #e6e6c9 50%, #d2d2a8 100%)');
                    root.style.setProperty('--taskbar-bg', 'linear-gradient(to bottom, #a67c52 0%, #8b5a2b 50%, #6d4c3d 100%)');
                    root.style.setProperty('--desktop-bg', 'radial-gradient(circle at 20% 80%, rgba(139, 107, 77, 0.7) 0%, rgba(109, 76, 61, 0.9) 100%)');
            }
            
            if (save) {
                localStorage.setItem('currentTheme', themeName);
            }
        }

        function handleWallpaperUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    document.body.style.backgroundImage = `url(${imageUrl})`;
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundPosition = 'center';
                    localStorage.setItem('customWallpaper', imageUrl);
                };
                reader.readAsDataURL(file);
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫
        function initInstaller() {
            const iconGrid = document.getElementById('iconGrid');
            const icons = ['üìù', 'üßÆ', 'üåê', 'üéµ', 'üìÅ', '‚öôÔ∏è', 'üé®', 'üì¶'];
            
            iconGrid.innerHTML = '';
            icons.forEach(icon => {
                const iconElement = document.createElement('div');
                iconElement.className = 'icon-option';
                iconElement.textContent = icon;
                iconElement.onclick = () => selectIcon(icon);
                iconGrid.appendChild(iconElement);
            });
            
            renderInstalledApps();
        }

        function selectIcon(icon) {
            document.querySelectorAll('.icon-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function installApp() {
            const name = document.getElementById('appName').value;
            const url = document.getElementById('appUrl').value;
            const selectedIcon = document.querySelector('.icon-option.selected');
            
            if (!name || !url || !selectedIcon) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É!');
                return;
            }
            
            const appId = 'app_' + Date.now();
            const newApp = {
                id: appId,
                name: name,
                url: url,
                icon: selectedIcon.textContent
            };
            
            installedApps.push(newApp);
            saveToLocalStorage();
            renderInstalledApps();
            renderDesktopIcons();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('appName').value = '';
            document.getElementById('appUrl').value = '';
            selectedIcon.classList.remove('selected');
            
            alert(`–ü—Ä–æ–≥—Ä–∞–º–º–∞ "${name}" —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª!`);
        }

        function renderInstalledApps() {
            const installedApps = JSON.parse(localStorage.getItem('installedApps')) || [];
            const container = document.getElementById('installedApps');
            
            container.innerHTML = '<h3>–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:</h3>';
            if (installedApps.length === 0) {
                container.innerHTML += '<div style="text-align: center; color: #666; padding: 20px;">–ù–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º</div>';
                return;
            }
            
            installedApps.forEach((app, index) => {
                const appElement = document.createElement('div');
                appElement.className = 'file-item';
                appElement.innerHTML = `
                    <span>${app.icon}</span> 
                    <span style="flex: 1;">${app.name}</span>
                    <span style="font-size: 10px; color: #666;" onclick="event.stopPropagation(); uninstallApp(${index})">üóëÔ∏è</span>
                `;
                appElement.onclick = () => openInstalledApp(app.id);
                container.appendChild(appElement);
            });
        }

        function uninstallApp(index) {
            const app = installedApps[index];
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É "${app.name}"?`)) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
                closeAppWindow(app.id);
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                installedApps.splice(index, 1);
                saveToLocalStorage();
                renderInstalledApps();
                renderDesktopIcons();
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
        function openApp(appName) {
            const window = document.getElementById(appName + 'Window');
            if (window) {
                window.style.display = 'block';
                window.style.zIndex = zIndex++;
                openApps[appName] = true;
                addToTaskbar(appName);
                document.getElementById('startMenu').style.display = 'none';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
                if (appName === 'notepad') initNotepad();
                if (appName === 'explorer') openFolder('system');
                if (appName === 'installer') initInstaller();
                if (appName === 'player') initPlayer();
                if (appName === 'gallery') renderThumbnails();
            }
        }

        function openInstalledApp(appId) {
            const app = installedApps.find(a => a.id === appId);
            if (!app) return;

            // –°–æ–∑–¥–∞–µ–º –æ–∫–Ω–æ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const appWindowId = `appWindow_${appId}`;
            let appWindow = document.getElementById(appWindowId);
            
            if (!appWindow) {
                appWindow = document.createElement('div');
                appWindow.className = 'app-window';
                appWindow.id = appWindowId;
                appWindow.style.top = '100px';
                appWindow.style.left = '100px';
                appWindow.style.width = '800px';
                appWindow.style.height = '600px';
                appWindow.style.display = 'block';
                appWindow.style.zIndex = zIndex++;

                appWindow.innerHTML = `
                    <div class="window-header">
                        <div class="window-title">${app.icon} ${app.name}</div>
                        <div class="window-controls">
                            <div class="window-control" onclick="minimizeAppWindow('${appId}')">_</div>
                            <div class="window-control" onclick="toggleMaximizeApp('${appId}')">‚ñ°</div>
                            <div class="window-control" onclick="closeAppWindow('${appId}')">√ó</div>
                        </div>
                    </div>
                    <iframe class="app-iframe" src="${app.url}" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
                `;

                document.getElementById('appWindowsContainer').appendChild(appWindow);
                makeWindowDraggable(appWindowId);
            } else {
                appWindow.style.display = 'block';
                appWindow.style.zIndex = zIndex++;
            }

            openApps[appId] = true;
            addToTaskbar(appId, app.name);
            document.getElementById('startMenu').style.display = 'none';
        }

        function toggleMaximizeApp(appId) {
            const appWindow = document.getElementById(`appWindow_${appId}`);
            if (appWindow) {
                appWindow.classList.toggle('maximized');
                const maxBtn = appWindow.querySelector('.window-controls .window-control:nth-child(2)');
                maxBtn.textContent = appWindow.classList.contains('maximized') ? '‚ùê' : '‚ñ°';
            }
        }

        function closeAppWindow(appId) {
            const appWindow = document.getElementById(`appWindow_${appId}`);
            if (appWindow) {
                appWindow.style.display = 'none';
                delete openApps[appId];
                removeFromTaskbar(appId);
            }
        }

        function minimizeAppWindow(appId) {
            const appWindow = document.getElementById(`appWindow_${appId}`);
            if (appWindow) {
                appWindow.style.display = 'none';
            }
        }

        function closeWindow(appName) {
            const window = document.getElementById(appName + 'Window');
            if (window) {
                window.style.display = 'none';
                delete openApps[appName];
                removeFromTaskbar(appName);
            }
        }

        function minimizeWindow(appName) {
            const window = document.getElementById(appName + 'Window');
            if (window) {
                window.style.display = 'none';
            }
        }

        function addToTaskbar(appName, customName = null) {
            const taskbarApps = document.getElementById('taskbarApps');
            const appNames = {
                'notepad': '–ë–ª–æ–∫–Ω–æ—Ç',
                'calculator': '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä',
                'browser': '–ë—Ä–∞—É–∑–µ—Ä',
                'player': '–ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å',
                'gallery': '–ì–∞–ª–µ—Ä–µ—è',
                'explorer': '–ü—Ä–æ–≤–æ–¥–Ω–∏–∫',
                'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                'themes': '–¢–µ–º—ã',
                'installer': '–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫'
            };

            if (!document.getElementById('taskbar-' + appName)) {
                const appElement = document.createElement('div');
                appElement.className = 'taskbar-app';
                appElement.id = 'taskbar-' + appName;
                appElement.textContent = customName || appNames[appName];
                appElement.onclick = () => {
                    if (appName.startsWith('app_')) {
                        const appWindow = document.getElementById(`appWindow_${appName}`);
                        if (appWindow) {
                            if (appWindow.style.display === 'none') {
                                appWindow.style.display = 'block';
                                appWindow.style.zIndex = zIndex++;
                            } else {
                                appWindow.style.display = 'none';
                            }
                        }
                    } else {
                        const window = document.getElementById(appName + 'Window');
                        if (window) {
                            if (window.style.display === 'none') {
                                window.style.display = 'block';
                                window.style.zIndex = zIndex++;
                            } else {
                                window.style.display = 'none';
                            }
                        }
                    }
                };
                taskbarApps.appendChild(appElement);
            }
        }

        function removeFromTaskbar(appName) {
            const appElement = document.getElementById('taskbar-' + appName);
            if (appElement) {
                appElement.remove();
            }
        }

        // –ú–µ–Ω—é –ü—É—Å–∫
        function toggleStartMenu() {
            const menu = document.getElementById('startMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // –í—ã–∫–ª—é—á–µ–Ω–∏–µ
        function shutdown() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–∫–ª—é—á–∏—Ç—å Nostalgia OS?')) {
                document.body.innerHTML = `
                    <div style="
                        background: #000;
                        color: #0f0;
                        font-family: 'Courier New', monospace;
                        height: 100vh;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        font-size: 24px;
                    ">
                        <div style="margin-bottom: 20px;">Nostalgia OS</div>
                        <div style="font-size: 16px;">–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...</div>
                        <div style="margin-top: 40px; font-size: 14px; color: #888;">
                            –¢–µ–ø–µ—Ä—å –∫–æ–º–ø—å—é—Ç–µ—Ä –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å
                        </div>
                    </div>
                `;
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        function toggleSeconds() {
            saveToLocalStorage();
            updateClock();
        }

        function toggleAutoRefresh() {
            saveToLocalStorage();
        }

        function resetSystem() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ!')) {
                localStorage.clear();
                location.reload();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function updateClock() {
            const now = new Date();
            const showSeconds = document.getElementById('showSeconds').checked;
            let timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            
            if (showSeconds) {
                timeString += ':' + now.getSeconds().toString().padStart(2, '0');
            }
            
            document.getElementById('clock').textContent = timeString;
        }

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ–∫–æ–Ω
        function makeWindowDraggable(windowId) {
            const window = document.getElementById(windowId);
            if (!window) return;
            
            const header = window.querySelector('.window-header');
            if (!header) return;
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            header.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                window.style.zIndex = zIndex++;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                window.style.top = (window.offsetTop - pos2) + "px";
                window.style.left = (window.offsetLeft - pos1) + "px";
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('click', hideContextMenu);
        document.getElementById('musicFileInput').addEventListener('change', handleMusicFiles);
        document.getElementById('imageFileInput').addEventListener('change', handleImageFiles);
        document.getElementById('wallpaperFileInput').addEventListener('change', handleWallpaperUpload);

        setInterval(updateClock, 1000);
        setInterval(updateClockWidget, 1000);
        setInterval(() => {
            if (widgetsEnabled) {
                updateSlideshow();
            }
        }, 5000);

        // –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
        loadFromLocalStorage();
        updateCalcDisplay();
        updateClock();
        
        // –î–µ–ª–∞–µ–º –æ–∫–Ω–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º–∏
        ['notepadWindow', 'calculatorWindow', 'browserWindow', 'playerWindow', 'galleryWindow', 'explorerWindow', 'settingsWindow', 'themesWindow', 'installerWindow'].forEach(makeWindowDraggable);
    </script>
</body>
</html>
