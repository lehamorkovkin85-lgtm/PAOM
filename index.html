<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∞–π—Ç 5–ë ‚Äî –ù–∞—à –∫–ª–∞—Å—Å!</title>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ, "—à–∫–æ–ª—å–Ω–æ–≥–æ" –≤–∏–¥–∞ */
        :root {
            --color-primary: #ff6b35; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
            --color-secondary: #4ecdc4; /* –ë–∏—Ä—é–∑–æ–≤—ã–π */
            --color-text: #374151; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
        }
        .font-friendly {
            font-family: 'Chalkboard SE', 'Comic Sans MS', 'cursive', sans-serif;
            color: var(--color-text);
        }
        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—à–∏—Ö —Ü–≤–µ—Ç–æ–≤ */
        .config-colors {
            --tw-bg-primary: var(--color-primary);
            --tw-bg-secondary: var(--color-secondary);
            --tw-text-primary: var(--color-primary);
            --tw-text-secondary: var(--color-secondary);
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö, –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-btn {
            @apply flex-1 py-3 px-2 md:px-6 text-xl md:text-2xl font-bold rounded-xl transition-all duration-200 shadow-lg transform hover:scale-105 hover:shadow-xl active:scale-95 text-white;
        }
        /* –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .content-card {
            @apply bg-white p-6 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-[1.01] border-4 border-gray-100;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∏–¥–∞) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--color-secondary);
            border-radius: 4px;
        }
        /* –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç—É—é –∞–Ω–∏–º–∞—Ü–∏—é "–ø—É–ª—å—Å–∞" –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è */
        @keyframes pulse-once {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-once {
            animation: pulse-once 2s ease-in-out infinite;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-orange': '#ff6b35',
                        'secondary-teal': '#4ecdc4',
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 font-friendly config-colors">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <header class="mb-8 md:mb-12">
        <h1 class="text-4xl md:text-6xl text-center font-extrabold mb-6 text-primary-orange">
            –°–∞–π—Ç –Ω–∞—à–µ–≥–æ 5&nbsp;–ë! üöÄ
        </h1>
        
        <nav class="flex space-x-2 md:space-x-4 max-w-5xl mx-auto">
            <button class="nav-btn bg-primary-orange" onclick="showSection('home')">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-btn bg-secondary-teal" onclick="showSection('schedule')">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –î–ó —É–¥–∞–ª–µ–Ω–∞ -->
            <button class="nav-btn bg-primary-orange" onclick="showSection('chat')">–ß–∞—Ç</button> <!-- NEW CHAT -->
            <button class="nav-btn bg-secondary-teal" onclick="showSection('photos')">–§–æ—Ç–æ</button>
            <button class="nav-btn bg-primary-orange" onclick="showSection('games')">–ò–≥—Ä—ã</button>
        </nav>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    <main id="content-container" class="max-w-5xl mx-auto space-y-8">
        
        <!-- 1. –ì–ª–∞–≤–Ω–∞—è (–ù–æ–≤–æ—Å—Ç–∏) -->
        <section id="section-home" class="content-card">
            <h2 class="text-3xl font-bold mb-6 text-primary-orange">üî• –ì–ª–∞–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞!</h2>
            <div id="news-feed" class="space-y-4">
                <!-- –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –∫–∞–Ω–∏–∫—É–ª–∞—Ö -->
                <div class="p-8 bg-primary-orange/20 border-l-8 border-primary-orange rounded-xl shadow-2xl animate-pulse-once">
                    <p class="text-3xl md:text-5xl font-extrabold text-primary-orange text-center transform hover:scale-105 transition duration-300">
                        ‚òÄÔ∏è –£–†–ê! –ù–ê–ß–ê–õ–ò–°–¨ –ö–ê–ù–ò–ö–£–õ–´! üèùÔ∏è
                    </p>
                    <p class="text-center text-gray-700 mt-4 text-xl font-semibold">
                        –ñ–µ–ª–∞–µ–º –≤—Å–µ–º –æ—Ç–ª–∏—á–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å! –í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è 24.11.25!
                    </p>
                </div>
                <!-- –ö–æ–Ω–µ—Ü –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
            </div>
        </section>

        <!-- 2. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
        <section id="section-schedule" class="content-card hidden">
            <h2 class="text-3xl font-bold mb-6 text-secondary-teal">üóìÔ∏è –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤</h2>
            <div class="overflow-x-auto">
                <table id="schedule-table" class="min-w-full table-auto border-separate border-spacing-1 md:border-spacing-2">
                    <thead>
                        <tr class="bg-primary-orange text-white text-left text-lg">
                            <th class="p-3 rounded-lg">–î–µ–Ω—å</th>
                            <th class="p-3 rounded-lg">1-–π —É—Ä–æ–∫</th>
                            <th class="p-3 rounded-lg">2-–π —É—Ä–æ–∫</th>
                            <th class="p-3 rounded-lg">3-–π —É—Ä–æ–∫</th>
                            <th class="p-3 rounded-lg">4-–π —É—Ä–æ–∫</th>
                            <th class="p-3 rounded-lg">5-–π —É—Ä–æ–∫</th>
                            <th class="p-3 rounded-lg">6-–π —É—Ä–æ–∫</th> 
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã JS –∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 3. –ß–∞—Ç -->
        <section id="section-chat" class="content-card hidden">
            <h2 class="text-3xl font-bold mb-6 text-primary-orange">üí¨ –ö–ª–∞—Å—Å–Ω—ã–π –ß–∞—Ç (5–ë)</h2>
            
            <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ò–º–µ–Ω–∏ (–î–æ–±–∞–≤–ª–µ–Ω–æ) -->
            <div id="name-prompt" class="p-4 bg-yellow-100 rounded-xl mb-4 border border-yellow-300 hidden">
                <p class="font-semibold mb-2 text-gray-700">–ü—Ä–∏–≤–µ—Ç! –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –∏–º—è, —á—Ç–æ–±—ã –æ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –≤ —á–∞—Ç–µ:</p>
                <div class="flex space-x-2">
                    <input type="text" id="name-input" placeholder="–í–∞—à–µ –∏–º—è –∏–ª–∏ –Ω–∏–∫ (–¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="20"
                           class="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary-orange text-base">
                    <button onclick="saveDisplayName()"
                            class="bg-primary-orange text-white py-2 px-4 rounded-lg font-bold transition hover:bg-primary-orange/90 active:scale-95">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <div id="auth-info" class="mb-4 text-sm text-gray-600">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à ID –∏ —Å—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
            </div>

            <div id="chat-window" class="h-96 bg-gray-100 p-4 overflow-y-auto rounded-xl mb-4 shadow-inner flex flex-col space-y-3">
                <div id="chat-loading" class="text-center text-gray-500 mt-20">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...</div>
            </div>

            <div class="flex">
                <input type="text" id="chat-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                       class="flex-1 p-3 border-2 border-gray-300 rounded-l-xl focus:outline-none focus:border-secondary-teal transition duration-150 text-base">
                <button onclick="sendMessage()" id="send-btn" disabled
                        class="bg-secondary-teal text-white py-3 px-6 rounded-r-xl font-bold transition-all duration-200 hover:bg-secondary-teal/90 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </section>

        <!-- 4. –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è -->
        <section id="section-photos" class="content-card hidden">
            <h2 class="text-3xl font-bold mb-6 text-secondary-teal">üì∏ –ù–∞—à–∏ –ª—É—á—à–∏–µ –º–æ–º–µ–Ω—Ç—ã</h2>
            
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <p class="text-gray-600 mb-4 md:mb-0">–ó–∞–≥—Ä—É–∑–∏ —Å–≤–æ–∏ –∫–ª–∞—Å—Å–Ω—ã–µ —Å–Ω–∏–º–∫–∏, —á—Ç–æ–±—ã –≤—Å–µ —É–≤–∏–¥–µ–ª–∏!</p>
                <input type="file" id="photo-upload-input" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                <button onclick="document.getElementById('photo-upload-input').click()"
                        class="bg-primary-orange text-white py-3 px-6 rounded-full font-bold shadow-md transition-all duration-200 hover:bg-primary-orange/90 hover:scale-105 active:scale-95 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
            </div>

            <div id="photo-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ç–æ -->
                <div class="aspect-square rounded-xl overflow-hidden shadow-lg transition duration-200 hover:shadow-2xl hover:scale-[1.03]">
                    <img src="https://placehold.co/400x400/ff6b35/ffffff?text=–ü–æ—Ö–æ–¥" onerror="this.src='https://placehold.co/400x400/ff6b35/ffffff?text=–§–æ—Ç–æ+1'" alt="–§–æ—Ç–æ 1" class="w-full h-full object-cover">
                </div>
                <div class="aspect-square rounded-xl overflow-hidden shadow-lg transition duration-200 hover:shadow-2xl hover:scale-[1.03]">
                    <img src="https://placehold.co/400x400/4ecdc4/ffffff?text=–£—Ä–æ–∫+–¢—Ä—É–¥–∞" onerror="this.src='https://placehold.co/400x400/4ecdc4/ffffff?text=–§–æ—Ç–æ+2'" alt="–§–æ—Ç–æ 2" class="w-full h-full object-cover">
                </div>
                <div class="aspect-square rounded-xl overflow-hidden shadow-lg transition duration-200 hover:shadow-2xl hover:scale-[1.03]">
                    <img src="https://placehold.co/400x400/ff6b35/ffffff?text=–°–ø–æ—Ä—Ç" onerror="this.src='https://placehold.co/400x400/ff6b35/ffffff?text=–§–æ—Ç–æ+3'" alt="–§–æ—Ç–æ 3" class="w-full h-full object-cover">
                </div>
                <div class="aspect-square rounded-xl overflow-hidden shadow-lg transition duration-200 hover:shadow-2xl hover:scale-[1.03]">
                    <img src="https://placehold.co/400x400/4ecdc4/ffffff?text=–î–†" onerror="this.src='https://placehold.co/400x400/4ecdc4/ffffff?text=–§–æ—Ç–æ+4'" alt="–§–æ—Ç–æ 4" class="w-full h-full object-cover">
                </div>
            </div>
            <p id="upload-status" class="mt-4 text-center text-green-600 font-semibold hidden"></p>
        </section>

        <!-- 5. –ò–≥—Ä—ã -->
        <section id="section-games" class="content-card hidden">
            <h2 class="text-3xl font-bold mb-6 text-primary-orange">üéÆ –ò–≥—Ä–æ–≤–æ–π —É–≥–æ–ª–æ–∫</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ 1: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º -->
                <div class="p-6 bg-pink-100 rounded-xl shadow-lg border-2 border-primary-orange transition duration-200 hover:shadow-xl">
                    <h3 class="text-2xl font-bold mb-4 text-primary-orange">üí° –ö–ª–∞—Å—Å–Ω–∞—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h3>
                    <p class="mb-4 text-gray-700">–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º 5 –∫–ª–∞—Å—Å–∞!</p>
                    <div id="quiz-area">
                        <p id="quiz-question" class="text-xl font-semibold mb-4"></p>
                        <div id="quiz-options" class="space-y-3">
                            <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ -->
                        </div>
                        <button id="start-quiz-btn" onclick="startQuiz()" class="bg-primary-orange text-white py-2 px-4 rounded-full font-bold mt-4 transition hover:scale-105 active:scale-95">
                            –ù–∞—á–∞—Ç—å!
                        </button>
                        <p id="quiz-feedback" class="mt-4 font-bold text-center"></p>
                    </div>
                </div>

                <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ 2: –ü–∞–∑–ª (–∏–º–∏—Ç–∞—Ü–∏—è) -->
                <div class="p-6 bg-teal-100 rounded-xl shadow-lg border-2 border-secondary-teal transition duration-200 hover:shadow-xl">
                    <h3 class="text-2xl font-bold mb-4 –Ω–∞ –≤—Ç–æ—Ä–∏—á–Ω—ã–π-teal">üß© –ü–∞–∑–ª "–ù–∞—à –∫–ª–∞—Å—Å"</h3>
                    <p class="mb-4 text-gray-700">–°–æ–±–µ—Ä–∏ –Ω–∞—à—É –∫–ª–∞—Å—Å–Ω—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é!</p>
                    <div class="aspect-[4/3] bg-gray-200 rounded-lg flex items-center justify-center border-4 border-secondary-teal border-dashed">
                        <img src="https://placehold.co/300x225/4ecdc4/ffffff?text=–ü–∞–∑–ª+5–ë" alt="–ü–∞–∑–ª" class="max-w-full max-h-full rounded-md opacity-80">
                    </div>
                    <button onclick="alertMessage('–û–π! –ü–∞–∑–ª –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–∫–æ—Ä–æ –±—É–¥–µ—Ç!')"
                            class="bg-secondary-teal text-white py-2 px-4 rounded-full font-bold mt-4 w-full transition hover:scale-105 active:scale-95">
                        –ò–≥—Ä–∞—Ç—å!
                    </button>
                </div>

            </div>
            
            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ alert) -->
            <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center border-4 border-primary-orange transform transition-transform duration-300 scale-0">
                    <p id="modal-text" class="text-xl font-semibold mb-6"></p>
                    <button onclick="closeAlertMessage()" class="bg-primary-orange text-white py-2 px-6 rounded-full font-bold hover:bg-primary-orange/90 active:scale-95 transition">
                        –ü–æ–Ω—è—Ç–Ω–æ
                    </button>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="mt-12 text-center text-gray-400 text-sm py-4">
        &copy; 2025 –°–∞–π—Ç 5–ë –∫–ª–∞—Å—Å–∞. –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∏ –±–∏—Ä—é–∑–æ–≤—ã–º —Ü–≤–µ—Ç–æ–º!
    </footer>

    <script type="module">
        // --- Firebase Imports (for Chat) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // –û–±–Ω–æ–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: –¥–æ–±–∞–≤–ª–µ–Ω—ã doc, getDoc, setDoc –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
        import { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp, setLogLevel, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ---
        const scheduleData = [
            { day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', lessons: ['–†–∞–∑–≥–æ–≤–æ—Ä—ã –æ –≤–∞–∂–Ω–æ–º', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ', '–ë–∏–æ–ª–æ–≥–∏—è', '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'] },
            { day: '–í—Ç–æ—Ä–Ω–∏–∫', lessons: ['–ï—Å—Ç–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ', '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–¢—Ä—É–¥', '–ò–ó–û', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'] },
            { day: '–°—Ä–µ–¥–∞', lessons: ['–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ò—Å—Ç–æ—Ä–∏—è', '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞', '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫'] },
            { day: '–ß–µ—Ç–≤–µ—Ä–≥', lessons: ['–¢—Ä—É–¥', '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ò—Å—Ç–æ—Ä–∏—è', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', ''] }, 
            { day: '–ü—è—Ç–Ω–∏—Ü–∞', lessons: ['–ú—É–∑—ã–∫–∞', '–ò—Å—Ç–æ—Ä–∏—è', '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'] },
            { day: '–°—É–±–±–æ—Ç–∞', lessons: ['', '', '', '', '', ''] }, 
        ];
        
        const quizQuestions = [
            { question: "–°–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∫–æ–≤ –Ω–∞ –ó–µ–º–ª–µ?", options: ["–ü—è—Ç—å", "–®–µ—Å—Ç—å", "–°–µ–º—å", "–ß–µ—Ç—ã—Ä–µ"], answer: "–®–µ—Å—Ç—å" },
            { question: "–°–∞–º–∞—è –∫—Ä—É–ø–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã?", options: ["–ú–∞—Ä—Å", "–Æ–ø–∏—Ç–µ—Ä", "–í–µ–Ω–µ—Ä–∞", "–ó–µ–º–ª—è"], answer: "–Æ–ø–∏—Ç–µ—Ä" },
            { question: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–ú—É–º—É'?", options: ["–ü—É—à–∫–∏–Ω", "–õ–µ—Ä–º–æ–Ω—Ç–æ–≤", "–¢—É—Ä–≥–µ–Ω–µ–≤", "–¢–æ–ª—Å—Ç–æ–π"], answer: "–¢—É—Ä–≥–µ–Ω–µ–≤" },
        ];
        
        let currentQuizIndex = 0;
        let score = 0;
        
        // --- Firebase/Chat Variables ---
        let app, db, auth;
        let currentUserId = null;
        let isFirebaseReady = false;
        let userDisplayName = null; // –ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –∏–º–µ–Ω–∏

        // --- Auth Logic: Handles sign-in asynchronously ---
        async function handleAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    // –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–æ–∫–µ–Ω–æ–º
                    await signInWithCustomToken(auth, __initial_auth_token);
                } catch (error) {
                    console.error("Primary sign-in failed, attempting anonymous sign-in.", error);
                    // Fallback to anonymous sign-in if the custom token fails
                    await signInAnonymously(auth);
                }
            } else {
                // –ê–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥, –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
                await signInAnonymously(auth);
            }
        }

        // --- Profile Management Logic ---
        function getProfileDocRef(appId, userId) {
            // –ü—É—Ç—å –¥–ª—è –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: /artifacts/{appId}/users/{userId}/profile/user_data
            return doc(db, `artifacts/${appId}/users/${userId}/profile/user_data`);
        }
        
        async function loadUserProfile(appId, userId) {
            try {
                const docRef = getProfileDocRef(appId, userId);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    userDisplayName = docSnap.data().displayName || null;
                    console.log("Loaded Display Name:", userDisplayName);
                } else {
                    userDisplayName = null;
                    console.log("No existing profile data found.");
                }
            } catch (e) {
                console.error("Error loading user profile:", e);
            }
        }
        
        window.saveDisplayName = async function() {
            const nameInput = document.getElementById('name-input');
            const newName = nameInput.value.trim().substring(0, 20); // –û–±—Ä–µ–∑–∫–∞ –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤
            
            if (newName.length < 2) {
                window.alertMessage("–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤!");
                return;
            }

            try {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const docRef = getProfileDocRef(appId, currentUserId);
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
                await setDoc(docRef, { displayName: newName }, { merge: true });
                
                userDisplayName = newName;
                window.alertMessage(`–ò–º—è '${newName}' —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!`);
                showNamePrompt(false);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                document.getElementById('auth-info').innerHTML = `–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span class="font-bold text-secondary-teal break-all">${currentUserId}</span> (–ò–º—è: <span class="text-primary-orange">${userDisplayName}</span>)`;

            } catch (e) {
                console.error("Error saving display name:", e);
                window.alertMessage("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
            }
        }
        
        function showNamePrompt(show) {
            const prompt = document.getElementById('name-prompt');
            if (prompt) {
                prompt.classList.toggle('hidden', !show);
            }
        }


        // --- Firebase Initialization ---
        async function initFirebase() {
            try {
                // setLogLevel('Debug'); // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing or empty.");
                    document.getElementById('chat-loading').textContent = "–û—à–∏–±–∫–∞: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
                    return;
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // 1. Wait for Auth to complete
                await handleAuth();

                // 2. Set user info and ready state after successful auth
                currentUserId = auth.currentUser?.uid || crypto.randomUUID(); 
                isFirebaseReady = true;
                
                // NEW: –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserProfile(appId, currentUserId);

                console.log("Firebase Auth Ready. User ID:", currentUserId);
                
                let authInfoText = `–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span class="font-bold text-secondary-teal break-all">${currentUserId}</span>`;
                if (userDisplayName) {
                     authInfoText += ` (–ò–º—è: <span class="text-primary-orange">${userDisplayName}</span>)`;
                }
                document.getElementById('auth-info').innerHTML = authInfoText;
                
                document.getElementById('send-btn').disabled = false;
                document.getElementById('chat-loading').textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...";
                
                // NEW: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏–º–µ–Ω–∏, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                showNamePrompt(!userDisplayName);
                
                // 3. Start Chat Listener ONLY after Auth is ready
                setupChatListener(appId);

            } catch (e) {
                console.error("Error initializing Firebase:", e);
                document.getElementById('chat-loading').textContent = "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–∞—Ç–∞. (–°–º. –∫–æ–Ω—Å–æ–ª—å)";
            }
        }
        
        // --- Chat Logic ---

        function setupChatListener(appId) {
            if (!db) {
                console.error("Firestore DB is not initialized.");
                document.getElementById('chat-loading').textContent = "–û—à–∏–±–∫–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.";
                return;
            }

            const messagesCollectionPath = `artifacts/${appId}/public/data/messages`;
            console.log("Attempting to listen to path:", messagesCollectionPath);
            const messagesCollectionRef = collection(db, messagesCollectionPath);
            
            // –ó–∞–ø—Ä–æ—Å, –±–µ–∑ orderBy –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
            const q = query(messagesCollectionRef); 

            onSnapshot(q, (snapshot) => {
                const chatLoading = document.getElementById('chat-loading'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                if (chatLoading) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
                    chatLoading.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º "–ó–∞–≥—Ä—É–∑–∫–∞..."
                }

                const messages = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    messages.push({ id: doc.id, ...data });
                });
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –ø–∞–º—è—Ç–∏ –ø–æ –º–µ—Ç–∫–µ –≤—Ä–µ–º–µ–Ω–∏
                messages.sort((a, b) => (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0));

                renderMessages(messages);
            }, (error) => {
                // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—à–∏–±–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
                if (error.code !== 'permission-denied') { 
                    console.error("Error listening to chat messages:", error);
                    document.getElementById('chat-loading').textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.";
                }
            });
        }

        function renderMessages(messages) {
            const chatWindow = document.getElementById('chat-window');
            chatWindow.innerHTML = '';
            
            if (messages.length === 0) {
                chatWindow.innerHTML = '<div class="text-center text-gray-500 mt-20">–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</div>';
                return;
            }

            messages.forEach(msg => {
                // currentUserId —Ç–µ–ø–µ—Ä—å –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤ initFirebase
                const isSelf = msg.userId === currentUserId; 
                const messageDiv = document.createElement('div');
                
                // –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
                const safeText = msg.text ? String(msg.text).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';
                const timestampText = msg.timestamp?.toDate() ? msg.timestamp.toDate().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }) : '—Å–µ–π—á–∞—Å';
                
                // NEW: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                let senderText = '';
                if (isSelf) {
                    senderText = '–í—ã';
                } else if (msg.displayName) {
                    senderText = msg.displayName; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∏–º—è, –µ—Å–ª–∏ –µ—Å—Ç—å
                } else {
                    senderText = msg.userId ? msg.userId : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'; // –ò–Ω–∞—á–µ –ø–æ–ª–Ω—ã–π ID
                }
                
                // –°—Ç–∏–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è
                messageDiv.className = `flex ${isSelf ? 'justify-end' : 'justify-start'}`;
                
                messageDiv.innerHTML = `
                    <div class="max-w-xs md:max-w-md p-3 rounded-xl shadow-md ${isSelf ? 'bg-secondary-teal text-white rounded-br-none' : 'bg-primary-orange/20 text-gray-800 rounded-tl-none'}">
                        <div class="text-xs font-bold mb-1 ${isSelf ? 'text-white' : 'text-primary-orange'} break-all">${senderText}</div>
                        <p class="text-sm md:text-base whitespace-pre-wrap">${safeText}</p>
                        <div class="text-[10px] text-right mt-1 opacity-70 ${isSelf ? 'text-white' : 'text-gray-600'}">${timestampText}</div>
                    </div>
                `;
                
                chatWindow.appendChild(messageDiv);
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }


        window.sendMessage = async function() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            // NEW: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–º–µ–Ω–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
            if (!userDisplayName) {
                showNamePrompt(true);
                window.alertMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–≤–æ–µ –∏–º—è –≤ –ø–æ–ª–µ –≤—ã—à–µ!");
                return;
            }
            
            if (!isFirebaseReady || !currentUserId || !text) {
                console.warn("–ß–∞—Ç –Ω–µ –≥–æ—Ç–æ–≤ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—É—Å—Ç–æ.");
                return;
            }

            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);

            try {
                // –†–µ–∞–ª–∏–∑—É–µ–º —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –æ—Ç–∫–∞—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
                for (let i = 0; i < 3; i++) {
                    try {
                        await addDoc(messagesCollectionRef, {
                            userId: currentUserId,
                            text: text,
                            timestamp: serverTimestamp(),
                            displayName: userDisplayName // NEW: –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
                        });
                        input.value = ''; // –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                        return; // –£—Å–ø–µ—Ö, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
                    } catch (error) {
                        if (i < 2) {
                            const delay = Math.pow(2, i) * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                        } else {
                            throw error; // –ë—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏
                        }
                    }
                }
            } catch (e) {
                console.error("Error sending message:", e);
                window.alertMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
            }
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSchedule();
            window.showSection('home');
            initFirebase(); // –¢–µ–ø–µ—Ä—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å Enter –¥–ª—è —á–∞—Ç–∞
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter' && !document.getElementById('send-btn').disabled) {
                        window.sendMessage();
                    }
                });
            }
        });

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏ ---
        window.showSection = function(sectionId) {
            document.querySelectorAll('section[id^="section-"]').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`section-${sectionId}`).classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
            if (sectionId === 'games') {
                document.getElementById('start-quiz-btn').classList.remove('hidden');
                document.getElementById('quiz-question').innerHTML = '';
                document.getElementById('quiz-options').innerHTML = '';
                document.getElementById('quiz-feedback').innerHTML = '–ù–∞–∂–º–∏ "–ù–∞—á–∞—Ç—å!" –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –í–∏–∫—Ç–æ—Ä–∏–Ω—ã!';
            }
        }
        
        // --- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ ---
        function renderSchedule() {
            const tbody = document.getElementById('schedule-table').querySelector('tbody');
            tbody.innerHTML = '';
            
            const todayIndex = new Date().getDay(); // 0=–í—Å, 1=–ü–Ω, ..., 6=–°–±
            
            scheduleData.forEach((item, index) => {
                const dayIndex = index + 1; // –ü–Ω=1, –í—Ç=2, ...
                const isToday = dayIndex === todayIndex;
                
                const row = document.createElement('tr');
                row.className = `text-gray-800 text-sm md:text-base ${isToday ? 'bg-yellow-200 font-extrabold shadow-inner' : 'bg-white hover:bg-gray-100 transition duration-150'}`;
                
                let rowHtml = `<td class="p-3 rounded-l-lg">${item.day}</td>`;
                item.lessons.forEach((lesson, lessonIndex) => {
                    const isLastLesson = lessonIndex === item.lessons.length - 1;
                    const lessonText = lesson || ''; // –ï—Å–ª–∏ —É—Ä–æ–∫–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ
                    rowHtml += `<td class="p-3 ${isLastLesson ? 'rounded-r-lg' : ''}">${lessonText}</td>`;
                });
                row.innerHTML = rowHtml;
                tbody.appendChild(row);
            });
        }
        
        // --- –§–æ—Ç–æ: –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ ---
        window.handlePhotoUpload = function(event) {
            const file = event.target.files[0];
            const status = document.getElementById('upload-status');
            
            if (file) {
                console.log('–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ:', file.name);
                status.textContent = `üéâ –§–∞–π–ª '${file.name}' —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (–∏–º–∏—Ç–∞—Ü–∏—è)! –°–ø–∞—Å–∏–±–æ!`;
                status.classList.remove('hidden');
                
                const newPhotoUrl = URL.createObjectURL(file);
                const grid = document.getElementById('photo-grid');
                const newPhotoDiv = document.createElement('div');
                newPhotoDiv.className = 'aspect-square rounded-xl overflow-hidden shadow-lg transition duration-200 hover:shadow-2xl hover:scale-[1.03]';
                newPhotoDiv.innerHTML = `<img src="${newPhotoUrl}" alt="–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ" class="w-full h-full object-cover">`;
                grid.prepend(newPhotoDiv); 
            }
            event.target.value = null;
        }

        // --- –ò–≥—Ä—ã: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ ---
        window.startQuiz = function() {
            currentQuizIndex = 0;
            score = 0;
            document.getElementById('start-quiz-btn').classList.add('hidden');
            document.getElementById('quiz-question').innerHTML = '';
            document.getElementById('quiz-options').innerHTML = '';
            document.getElementById('quiz-feedback').innerHTML = '–ù–∞–∂–º–∏ "–ù–∞—á–∞—Ç—å!" –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –í–∏–∫—Ç–æ—Ä–∏–Ω—ã!';
            showQuestion();
        }
        
        function showQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                document.getElementById('quiz-question').textContent = `–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ ${quizQuestions.length}!`;
                document.getElementById('quiz-options').innerHTML = '';
                document.getElementById('quiz-feedback').textContent = score === quizQuestions.length ? '–°—É–ø–µ—Ä! –¢—ã ‚Äî –≥–µ–Ω–∏–π!' : '–ù–µ–ø–ª–æ—Ö–æ! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!';
                document.getElementById('start-quiz-btn').textContent = '–°—ã–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑';
                document.getElementById('start-quiz-btn').classList.remove('hidden');
                return;
            }
            
            const q = quizQuestions[currentQuizIndex];
            document.getElementById('quiz-question').textContent = `–í–æ–ø—Ä–æ—Å ${currentQuizIndex + 1}: ${q.question}`;
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = option;
                btn.className = 'w-full text-left bg-secondary-teal/80 text-white py-2 px-4 rounded-lg font-semibold transition hover:bg-secondary-teal hover:scale-[1.02] active:scale-[0.98]';
                btn.onclick = () => checkAnswer(option, q.answer);
                optionsDiv.appendChild(btn);
            });
        }
        
        function checkAnswer(selected, correct) {
            const feedback = document.getElementById('quiz-feedback');
            document.getElementById('quiz-options').querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                feedback.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü! üéâ';
                feedback.className = 'mt-4 font-bold text-center text-green-600';
                score++;
            } else {
                feedback.textContent = `–û—à–∏–±–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correct} üòü`;
                feedback.className = 'mt-4 font-bold text-center text-red-600';
            }
            
            currentQuizIndex++;
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º
            setTimeout(() => {
                showQuestion();
            }, 1500);
        }

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º (–≤–º–µ—Å—Ç–æ alert) ---
        window.alertMessage = function(text) {
            document.getElementById('modal-text').textContent = text;
            const modal = document.getElementById('message-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                modal.querySelector('div').classList.remove('scale-0');
                modal.querySelector('div').classList.add('scale-100');
            }, 10);
        }

        window.closeAlertMessage = function() {
            const modal = document.getElementById('message-modal');
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-0');
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }
    </script>
</body>
</html>
